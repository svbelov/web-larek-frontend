# Проектная работа "Веб-ларек"

## Описание

Проект представляет собой реализацию интернет-магазина с товарами для веб-разработчиков — Web-ларёк. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ. 

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Интерфейс для описания структуры данных единицы товара

```
export interface IProductItem  {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
}
```

Интерфейс общего состояния приложения

```
export interface IAppState {
    catalog: IProductItem[];
    basket: IProductItem[];
    preview: string | null;
    order: IOrder | null;
	formErrors: TFormErrors;
}
```

Интерфейс с описанием всех данных, необходимых для указания при оформлении заказа

```
export interface IOrderForm {
    payment: string;
    address: string;
    email: string;
    phone: string;
}
```


Тип возможных ошибок валидации
```
export type TFormErrors = {
    payment?: string;
    address?: string;
    email?: string;
    phone?: string;
}
```

## Архитектура приложения

Код приложения разделён на слои, соответствующие архитектурному паттерну MVP (Model-View-Presenter):
- слой данных (Model) отвечает за хранение и изменение  данных;
- слой представления (View) отвечает за отображение данных на странице;
- перезентер (Presenter) отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передаётся базовый адрес сервера и опциональный объект с заголовками запросов.

Конструктор класса:
```
`constructor(baseUrl: string, options: RequestInit = {})` - принимает базовый URL API и глобальные параметры для всех запросов (опционально).
```
Свойства:
- `baseUrl: string` - базовый URL для всех запросов;
- `options: RequestInit;` - параметры для всех запросов.

Методы:
- `handleResponse` - обрабатывает ответ от сервера, возвращает данные в формате JSON или ошибку;
- `get` - выполняет GET-запрос на переданный в параметрах эндпоинт и возвращает промис с объектом, которым ответил сервер;
- `post` - принимает объект с данными, которые будут переданы в теле запроса в формате JSON, и оптравляет эти данные на эндпоинт, переданный как параметр при вызове метода. По умолчанию выполняется POST-запрос, но метод HTTP может быть переопределён заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в перезентере для обработки событий и в слоях приложения для генерации событий.

Конструктор класса:
```
`constructor() {
    this._events = new Map<EventName, Set<Subscriber>>();
} - создаёт пустую коллекцию для хранения событий и обработчиков.
```
Свойства:
- `_events: Map<EventName, Set<Subscriber>>` - свойство, которое хранит все события и подписки на них.

Основные методы, реализуемые классом описаны интерфейсом `IEvents`:    
- `on` - подписка на события;
- `emit`- инициализация события;
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

#### Класс Component
Абстрактный базовый класс для создания компонентов пользовательского интерфейса. Он предоставляет набор методов для работы с DOM-элементами, упрощая управление состоянием и визуальными изменениями.

Методы:
- `toggleClass` - переключает класс у элемента;
- `setText` - устанавливает текстовое содержимое элемента;
- `setDisabled` - меняет статус блокировки элемента;
- `setHidden` - скрываеь элемент;
- `setVisible` - отображает элемент;
- `setImage` - устанавливает изображение и алтернативный текст;
- `render` - возвращает корневой DOM-элемент.

#### Класс Model
Абстрактный базовый класс модели данных для управления состоянием модели. Используется и для представлени, и для работы с данными.

Метод:
- `emitChanges` - создаёт уникальное событие для уведомления об изменении модели.

### Слой данных

#### Класс AppState
Класс расширяет класс Model, отвечает за хранение состояния приложения (каталог товаров, данные о заказе, ошибки валидации форм, а также методы работы с данными).
В свойствах класса хранит: массив товаров магазина, массив товаров в корзине, данные заказа, ошибки форм.\
Свойства:
- `catalog: ProductItem[]` - массив товаров в каталоге;
- `basket: ProductItem[]` - массив товаров в корзине;
- `preview: string | null` - идентификатор товара для предпросмотра;
- `order: IOrder` - данные заказа;
- `formErrors: TFormErrors` - ошибки форм ввода.

Методы:
- `setCatalog` - устанавливает каталог карточек товаров;
- `getTotal` - вычисляет общую стоимость товаров в корзине;
- `clearBasket` - очищает корзину;
- `setPreview` - устанавливает превью карточки;
- `addToBasket` - добавляет товар в корзину;
- `removeFromBasket` - удаляет товар из корзины;
- `clearOrder` - очистка информации о заказе;
- `validateOrderForm` - валидация полей формы заказа;
- `setOrderField` - обновить значение поля формы заказа и проверить валидность;
- `updateBasket` - обновление состояния корзины.

#### Класс ProductItem
Класс расширяет класс Model, отвечает за хранение данных о единице товара.
Свойства:
- `id: string` - ID товара;
- `description: string` - описание товара;
- `image: string` - изображение товара;
- `title: string` - название товара;
- `category: string` - категория товара;
- `price: number | null` - цена товара.

#### Класс StoreApi
Класс расширяет класс Api, добавляя дополнительные методы.

Конструктор класса:
```
`constructor(cdn: string, baseUrl: string, options?: RequestInit)` - принимает URL CDN-сервера, базовый URL API и опциональные параметры для настройки запросов.
```
Свойства:
- `cdn: string` - URL CDN-сервера;

Методы:
- `getProductList` - получение каталога карточек товаров с сервера;
- `getProductItem` - получение карточки товара по идентификатору;
- `orderProducts` - отправка информации об оформленном заказе на сервер.

### Слой представления

#### Класс Basket
Класс расширяет базовый класс Component и реализует компонент корзины в пользовательском интерфейсе.

Конструктор класса:
```
`constructor(container: HTMLElement, protected events: EventEmitter)` - принимает корневой HTML-элемент для корзины и экземпляр EventEmitter для отправки событий.
```
Свойства класса:
- `_list: HTMLElement` - список товаров в корзине;
- `_total: HTMLElement` - общая стоимость товаров в корзине;
- `_button: HTMLButtonElement` - кнопка перехода к оформленю заказа.

Методы:
- `set items` - сеттер обновляет список товаров в корзине;
- `set total` - сеттер обновляет отображение общей стоимости товаров.

#### Класс Modal
Класс раширяет базовый класс Component и реализует модальные окна.

Конструктор класса:
```
`constructor(container: HTMLElement, protected events: IEvents)` - принимает корневой HTML-элемент для модального окна и экземпляр EventEmitter для отправки событий.
```
Свойтсва:
- `_closeButton: HTMLButtonElement` - кнопка закрытия модального окна;
- `_content: HTMLElement` - содержимое модального окна.

Методы:
- `open` - открытие модального окна;
- `close` - закрытие модального окна;
- `render` - отображение модального окна на странице.

#### Класс Success
Класс раширяет базовый класс Component и предназначен для отображения сообщения об успешном завершении заказа.

Конструктор класса:
```
`constructor(container: HTMLElement, actions: ISuccessActions)` - принимает корневой HTML-элемент и объект действий с обработчиком клика.
```
Свойства:
- `_close: HTMLButtonElement` - кнопка закрытия окна сообщения;
- `_total: HTMLElement` - стоимость заказа.

Метод:
- `set total` - сеттер устанавливает информацию о стоимости заказ;

#### Класс Card
Класс раширяет базовый класс Component и реализует отображение карточки товара на странице и управление ими в каталоге и корзине.

Конструктор класса:
```
`constructor(container: HTMLElement, actions?: ICardActions)` - принимает корневой HTML-элемент карточки товара и объект действий с обработчиком клика.
```
Свойства:
 - `_description: HTMLElement` - описание товара;
 - `_image: HTMLImageElement` - изображение товара;
 - `_title: HTMLElement` - название товара;
 - `_category: HTMLElement` - категория товара;
 - `_price: HTMLElement` - цена товара;
 - `_index: HTMLElement` - номер товара в корзине по порядку;
 - `_button: HTMLButtonElement` - кнопка в карточке товара;
 - `_buttonText` - текст кнопки.

Методы:
- `set id / get id` - сеттер / геттер идентификатора карточки;
- `set title / get title` - сеттер / геттер текста заголовка карточки;
- `set image` - сеттер усатанавливает изображение;
- `set category/get category` - сеттер усатанавливает категорию карточки;
- `set price / get price` - сеттер и геттер цены товара;
- `set buttonText` - сеттер текста кнопки;
- `set index / get index` - сеттер и геттер порлкового номера;
- `set description` - сеттер описания товара.

#### Класс Form
Класс раширяет базовый класс Component и предоставляет базовый функционал для работы с HTML-формами: управление состянием формы, валидность, отображение ошибок.

Конструктор класса:
```
`constructor(protected container: HTMLFormElement, protected events: IEvents)` - принимает HTML-элемент формы и элемент обработки событий (действий пользователя).
```
Свойства
- `_submit: HTMLButtonElement` - кнопка отправки формы;
- `_errors: HTMLElement` - элемент отображения ошибок валидации.

Методы:
- `onInputChange` - вызывается при изменении значения поля формы;
- `set valid` - сеттер управдляет состоянием кнопки при валидации;
- `set errors` - сеттер ошибок валидации;
- `render` - отображает состояние формы, валидность, ошибки и значения поля.

#### Класс Page
Класс раширяет базовый класс Component и реализует отображение главной страницы.

Конструктор класса:
```
`constructor(container: HTMLElement, protected events: IEvents)` - принимает HTML-элемент страницы и элемент обработки действий пользователя.
```
Свойства:
- `counter: HTMLElement`- элемент отображения количества товаров в корзине;
- `_catalog: HTMLElement` - элемент отображения каталога товаров на странице;
-- `_basket: HTMLElement` -  элемент отображения корзины.

Методы:
- `set counter` - сеттер устанавливает текущее значение счетчика корзины;
- `set catalog` - сеттер обновляет список элементов в каталоге;
- `set locked` - сеттер управляет состоянием блокировки страницы.


#### Класс Order
Класс расширяет класс Form и предоставляет интерфейс выбор способа оплаты и ввода адреса доставки.

Конструктор класса:
```
`constructor(container: HTMLFormElement, events: IEvents, actions?: IOrderActions)` - принимает HTML-элемент формы заказа, элемент обработки действий пользователя и объект действий с обработчиком клика.
```
Свойства:
- `_onlinePayButton: HTMLButtonElement `- кнопка варианта онлайн оплаты;
- `_cashPayButton: HTMLButtonElement` - кнопка варианта оплаты при получени;
- `_address: HTMLInputElement` - поле ввода адреса.

Методы:
- `togglePayButtons` - переключает активное состояние кнопок вариантов оплаты;
- `set address` - сеттер устанавливает значение для поля ввода адреса.

#### Класс Contacts
Класс расширяет класс Form и предоставляет интерфейс для ввода контактов покупателя.

Конструктор класса:
```
`constructor(container: HTMLFormElement, events: IEvents)` - принимает HTML-элемент формы контактов, элемент обработки действий пользователя.
```
Свойства:
- `_phone: HTMLInputElement` - поле ввода телефона;
- `_email: HTMLInputElement` - поле ввода адреса email.
Методы:
- `set phone` - сеттер устанавливает значение для поля ввода телефона;
- `set email` - сеттер устанавливает значение для поля вода адреса email.

### Слой коммуникации
Связь между данными и пользовательским интерфейсом, включая обновление отображения при изменении состояния, реализована в коде файла index.ts, в том числе
создание объектов классов для управления данными, интерфейсом и состоянием приложения, а также обработка событий с помощью брокера событий, обеспечивающего координацию действий между компонентами.
